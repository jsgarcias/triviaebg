"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = vcc;

var _deepmerge = _interopRequireDefault(require("deepmerge"));

var config = require('../res/config.json');

function vcc(req, res, next) {
  var headerOverrides = {};

  try {
    headerOverrides = JSON.parse(req.headers['x-trusted-koji-overrides'] || {});
  } catch (err) {//
  }

  var resolvedConfig = (0, _deepmerge["default"])(config, headerOverrides, {
    arrayMerge: function arrayMerge(dest, source) {
      return source;
    }
  });
  res.locals.koji = resolvedConfig; // Set env vars

  process.env.KOJI_PROJECT_ID = req.headers['x-trusted-koji-project-id'] || process.env.KOJI_PROJECT_ID;
  process.env.KOJI_PROJECT_TOKEN = req.headers['x-trusted-koji-project-token'] || process.env.KOJI_PROJECT_TOKEN;
  next();
}